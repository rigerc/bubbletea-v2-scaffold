// Package fonts provides ASCII art font definitions for banner generation.
package fonts

import "strings"

// Font represents an ASCII art font with character mappings.
type Font struct {
	Name     string
	Height   int
	Chars    map[rune][]string
	Fallback rune
}

// GetLine returns a specific line of a character's ASCII art.
func (f Font) GetLine(char rune, line int) string {
	if charArt, ok := f.Chars[char]; ok && line < len(charArt) {
		return charArt[line]
	}
	// Fallback to space or specified fallback character
	if charArt, ok := f.Chars[f.Fallback]; ok && line < len(charArt) {
		return charArt[line]
	}
	return strings.Repeat(" ", 4)
}

// GetWidth returns the width of a specific character.
func (f Font) GetWidth(char rune) int {
	if charArt, ok := f.Chars[char]; ok && len(charArt) > 0 {
		return len([]rune(charArt[0]))
	}
	return 4
}

// scaleLine scales a single line by repeating each character.
func scaleLine(line string, scale int) string {
	if scale <= 1 {
		return line
	}
	runes := []rune(line)
	var result strings.Builder
	for _, r := range runes {
		result.WriteString(strings.Repeat(string(r), scale))
	}
	return result.String()
}

// scaleFontLines scales all lines of a character vertically.
func scaleFontLines(lines []string, scale int) []string {
	if scale <= 1 {
		return lines
	}
	scaled := make([]string, 0, len(lines)*scale)
	for _, line := range lines {
		// Repeat each line 'scale' times
		for i := 0; i < scale; i++ {
			scaled = append(scaled, line)
		}
	}
	return scaled
}

// Block font - Large decorative block letters.
var Block = Font{
	Name:     "block",
	Height:   6,
	Fallback: ' ',
	Chars: map[rune][]string{
		'A': {" █████╗ ", "██╔══██╗", "███████║", "██╔══██║", "██║  ██║", "╚═╝  ╚═╝"},
		'B': {"██████╗ ", "██╔══██╗", "██████╔╝", "██╔══██╗", "██████╔╝", "╚═════╝ "},
		'C': {" ██████╗", "██╔════╝", "██║     ", "██║     ", "╚██████╗", " ╚═════╝"},
		'D': {"██████╗ ", "██╔══██╗", "██║  ██║", "██║  ██║", "██████╔╝", "╚═════╝ "},
		'E': {"███████╗", "██╔════╝", "█████╗  ", "██╔══╝  ", "███████╗", "╚══════╝"},
		'F': {"███████╗", "██╔════╝", "█████╗  ", "██╔══╝  ", "██║     ", "╚═╝     "},
		'G': {" ██████╗ ", "██╔════╝ ", "██║  ███╗", "██║   ██║", "╚██████╔╝", " ╚═════╝ "},
		'H': {"██╗  ██╗", "██║  ██║", "███████║", "██╔══██║", "██║  ██║", "╚═╝  ╚═╝"},
		'I': {"██╗", "██║", "██║", "██║", "██║", "╚═╝"},
		'J': {"     ██╗", "     ██║", "     ██║", "██   ██║", "╚█████╔╝", " ╚════╝ "},
		'K': {"██╗  ██╗", "██║ ██╔╝", "█████╔╝ ", "██╔═██╗ ", "██║  ██╗", "╚═╝  ╚═╝"},
		'L': {"██╗     ", "██║     ", "██║     ", "██║     ", "███████╗", "╚══════╝"},
		'M': {"███╗   ███╗", "████╗ ████║", "██╔████╔██║", "██║╚██╔╝██║", "██║ ╚═╝ ██║", "╚═╝     ╚═╝"},
		'N': {"███╗   ██╗", "████╗  ██║", "██╔██╗ ██║", "██║╚██╗██║", "██║ ╚████║", "╚═╝  ╚═══╝"},
		'O': {" ██████╗ ", "██╔═══██╗", "██║   ██║", "██║   ██║", "╚██████╔╝", " ╚═════╝ "},
		'P': {"██████╗ ", "██╔══██╗", "██████╔╝", "██╔═══╝ ", "██║     ", "╚═╝     "},
		'Q': {" ██████╗ ", "██╔═══██╗", "██║   ██║", "██║▄▄ ██║", "╚██████╔╝", " ╚══▀▀═╝ "},
		'R': {"██████╗ ", "██╔══██╗", "██████╔╝", "██╔══██╗", "██║  ██║", "╚═╝  ╚═╝"},
		'S': {"███████╗", "██╔════╝", "███████╗", "╚════██║", "███████║", "╚══════╝"},
		'T': {"████████╗", "╚══██╔══╝", "   ██║   ", "   ██║   ", "   ██║   ", "   ╚═╝   "},
		'U': {"██╗   ██╗", "██║   ██║", "██║   ██║", "██║   ██║", "╚██████╔╝", " ╚═════╝ "},
		'V': {"██╗   ██╗", "██║   ██║", "██║   ██║", "╚██╗ ██╔╝", " ╚████╔╝ ", "  ╚═══╝  "},
		'W': {"██╗    ██╗", "██║    ██║", "██║ █╗ ██║", "██║███╗██║", "╚███╔███╔╝", " ╚══╝╚══╝ "},
		'X': {"██╗  ██╗", "╚██╗██╔╝", " ╚███╔╝ ", " ██╔██╗ ", "██╔╝ ██╗", "╚═╝  ╚═╝"},
		'Y': {"██╗   ██╗", "╚██╗ ██╔╝", " ╚████╔╝ ", "  ╚██╔╝  ", "   ██║   ", "   ╚═╝   "},
		'Z': {"███████╗", "╚══███╔╝", "  ███╔╝ ", " ███╔╝  ", "███████╗", "╚══════╝"},
		'0': {" ██████╗ ", "██╔═████╗", "██║██╔██║", "████╔╝██║", "╚██████╔╝", " ╚═════╝ "},
		'1': {" ██╗", "███║", "╚██║", " ██║", " ██║", " ╚═╝"},
		'2': {"██████╗ ", "╚════██╗", " █████╔╝", "██╔═══╝ ", "███████╗", "╚══════╝"},
		'3': {"██████╗ ", "╚════██╗", " █████╔╝", " ╚═══██╗", "██████╔╝", "╚═════╝ "},
		'4': {"██╗  ██╗", "██║  ██║", "███████║", "╚════██║", "     ██║", "     ╚═╝"},
		'5': {"███████╗", "██╔════╝", "███████╗", "╚════██║", "███████║", "╚══════╝"},
		'6': {" ██████╗ ", "██╔════╝ ", "███████╗ ", "██╔═══██╗", "╚██████╔╝", " ╚═════╝ "},
		'7': {"███████╗", "╚════██║", "    ██╔╝", "   ██╔╝ ", "   ██║  ", "   ╚═╝  "},
		'8': {" █████╗ ", "██╔══██╗", "╚█████╔╝", "██╔══██╗", "╚█████╔╝", " ╚════╝ "},
		'9': {" █████╗ ", "██╔══██╗", "╚██████║", " ╚═══██║", " █████╔╝", " ╚════╝ "},
		' ': {"    ", "    ", "    ", "    ", "    ", "    "},
		'-': {"      ", "      ", "█████╗", "╚════╝", "      ", "      "},
		'.': {"   ", "   ", "   ", "   ", "██╗", "╚═╝"},
		'!': {"██╗", "██║", "██║", "╚═╝", "██╗", "╚═╝"},
		'?': {"██████╗ ", "╚════██╗", "  ▄███╔╝", "  ▀▀══╝ ", "  ██╗   ", "  ╚═╝   "},
		'_': {"        ", "        ", "        ", "        ", "███████╗", "╚══════╝"},
	},
}

// Slant font - Slanted/italic style letters.
var Slant = Font{
	Name:     "slant",
	Height:   5,
	Fallback: ' ',
	Chars: map[rune][]string{
		'A': {"    ___   ", "   /   |  ", "  / /| |  ", " / ___ |  ", "/_/  |_|  "},
		'B': {"    ____ ", "   / __ )", "  / __  |", " / /_/ / ", "/_____/  "},
		'C': {"   ______", "  / ____/", " / /     ", "/ /___   ", "\\____/   "},
		'D': {"    ____ ", "   / __ \\", "  / / / /", " / /_/ / ", "/_____/  "},
		'E': {"    ______", "   / ____/", "  / __/   ", " / /___   ", "/_____/   "},
		'F': {"    ______", "   / ____/", "  / /_    ", " / __/    ", "/_/       "},
		'G': {"   ______", "  / ____/", " / / __  ", "/ /_/ /  ", "\\____/   "},
		'H': {"    __  __", "   / / / /", "  / /_/ / ", " / __  /  ", "/_/ /_/   "},
		'I': {"    ____", "   /  _/", "   / /  ", " _/ /   ", "/___/   "},
		'J': {"       __", "      / /", " __  / / ", "/ /_/ /  ", "\\____/   "},
		'K': {"    __ __", "   / //_/", "  / ,<   ", " / /| |  ", "/_/ |_|  "},
		'L': {"    __ ", "   / / ", "  / /  ", " / /___", "/_____/"},
		'M': {"    __  ___", "   /  |/  /", "  / /|_/ / ", " / /  / /  ", "/_/  /_/   "},
		'N': {"    _   __", "   / | / /", "  /  |/ / ", " / /|  /  ", "/_/ |_/   "},
		'O': {"   ____ ", "  / __ \\", " / / / /", "/ /_/ / ", "\\____/  "},
		'P': {"    ____ ", "   / __ \\", "  / /_/ /", " / ____/ ", "/_/      "},
		'Q': {"   ____ ", "  / __ \\", " / / / /", "/ /_/ / ", "\\___\\_\\ "},
		'R': {"    ____ ", "   / __ \\", "  / /_/ /", " / _, _/ ", "/_/ |_|  "},
		'S': {"   _____", "  / ___/", "  \\__ \\ ", " ___/ / ", "/____/  "},
		'T': {"  ______", " /_  __/", "  / /   ", " / /    ", "/_/     "},
		'U': {"   __  __", "  / / / /", " / / / / ", "/ /_/ /  ", "\\____/   "},
		'V': {"   _    __", "  | |  / /", "  | | / / ", "  | |/ /  ", "  |___/   "},
		'W': {"  _       __", " | |     / /", " | | /| / / ", " | |/ |/ /  ", " |__/|__/   "},
		'X': {"   _  __", "  | |/ /", "  |   / ", " /   |  ", "/_/|_|  "},
		'Y': {"__  __", `\ \/ /`, ` \  / `, " / /  ", "/_/   "},
		'Z': {" _____", "/__  /", "  / / ", " / /__", "/____/"},
		'0': {"   ____ ", "  / __ \\", " / / / /", "/ /_/ / ", "\\____/  "},
		'1': {"    __", "   / /", "  / / ", " / /  ", "/_/   "},
		'2': {"   ___ ", "  |__ \\", "  __/ / ", " / __/  ", "/____/  "},
		'3': {"   _____", "  |__  /", "   /_ < ", " ___/ / ", "/____/  "},
		'4': {"  / / / /", " / / / / ", "/ /_/ /  ", "\\____/   "},
		'5': {"    ______", "   / ____/", "  /___ \\ ", " ____/ / ", "/_____/  "},
		'6': {"   _____", "  / ___/", " / __ \\ ", "/ /_/ / ", "\\____/  "},
		'7': {" _____", "/__  /", "  / / ", " / /  ", "/_/   "},
		'8': {"   ____ ", "  ( __ )", " / __  |", "/ /_/ / ", "\\____/  "},
		'9': {"   ____ ", "  / __ \\", " / /_/ /", " \\__, / ", "/____/  "},
		' ': {"   ", "   ", "   ", "   ", "   "},
		'-': {"       ", "       ", " ______", "/_____/", "       "},
		'.': {"   ", "   ", "   ", "   ", " _ "},
		'!': {"   ", "   ", "   ", " _ ", "(_)", "    "},
	},
}

// Minimal font - Compact 3-line letters.
var Minimal = Font{
	Name:     "minimal",
	Height:   3,
	Fallback: ' ',
	Chars: map[rune][]string{
		'A': {"█▀█", "█▀█", "▀ ▀"},
		'B': {"█▀▄", "█▀▄", "▀▀ "},
		'C': {"█▀▀", "█  ", "▀▀▀"},
		'D': {"█▀▄", "█ █", "▀▀ "},
		'E': {"█▀▀", "█▀▀", "▀▀▀"},
		'F': {"█▀▀", "█▀▀", "▀  "},
		'G': {"█▀▀", "█ █", "▀▀▀"},
		'H': {"█ █", "█▀█", "▀ ▀"},
		'I': {"█", "█", "▀"},
		'J': {"  █", "  █", "▀▀ "},
		'K': {"█ █", "█▀▄", "▀ ▀"},
		'L': {"█  ", "█  ", "▀▀▀"},
		'M': {"█▄█", "█ █", "▀ ▀"},
		'N': {"█▀█", "█ █", "▀ ▀"},
		'O': {"█▀█", "█ █", "▀▀▀"},
		'P': {"█▀█", "█▀▀", "▀  "},
		'Q': {"█▀█", "█ █", "▀▀▄"},
		'R': {"█▀█", "█▀▄", "▀ ▀"},
		'S': {"█▀▀", "▀▀█", "▀▀▀"},
		'T': {"▀█▀", " █ ", " ▀ "},
		'U': {"█ █", "█ █", "▀▀▀"},
		'V': {"█ █", "█ █", " ▀ "},
		'W': {"█ █", "█ █", "▀▀▀"},
		'X': {"█ █", " ▀ ", "█ █"},
		'Y': {"█ █", " █ ", " ▀ "},
		'Z': {"▀▀█", " █ ", "█▀▀"},
		'0': {"█▀█", "█ █", "▀▀▀"},
		'1': {"▄█ ", " █ ", "▀▀▀"},
		'2': {"█▀█", " ▄▀", "█▄▄"},
		'3': {"█▀▀", "▀▀█", "▄▄▀"},
		'4': {"█ █", "▀▀█", "  ▀"},
		'5': {"█▀▀", "▀▀▄", "▄▄▀"},
		'6': {"█▀▀", "█▀█", "▀▀▀"},
		'7': {"▀▀█", "  █", "  ▀"},
		'8': {"█▀█", "█▀█", "▀▀▀"},
		'9': {"█▀█", "▀▀█", "  ▀"},
		' ': {" ", " ", " "},
		'-': {"  ", "▀▀", "  "},
		'.': {"  ", "  ", "▄"},
		'!': {"█", "█", "▄"},
	},
}

// Small font - Compact but readable 4-line letters.
var Small = Font{
	Name:     "small",
	Height:   4,
	Fallback: ' ',
	Chars: map[rune][]string{
		'A': {"┌─┐", "├─┤", "┴ ┴", "   "},
		'B': {"┌┐ ", "├┴┐", "┴─┘", "   "},
		'C': {"┌─┐", "│  ", "└─┘", "   "},
		'D': {"┌┬┐", "│ │", "┴─┘", "   "},
		'E': {"┌─┐", "├┤ ", "└─┘", "   "},
		'F': {"┌─┐", "├┤ ", "┴  ", "   "},
		'G': {"┌─┐", "│ ┌", "└─┘", "   "},
		'H': {"┬ ┬", "├─┤", "┴ ┴", "   "},
		'I': {"┬", "│", "┴", " "},
		'J': {"  ┬", "  │", "└─┘", "   "},
		'K': {"┬┌─┐", "├┴┐", "┴ └─┘", "     "},
		'L': {"┬  ", "│  ", "└─┘", "   "},
		'M': {"┌┬┐", "│││", "┴ ┴", "   "},
		'N': {"┌┐┌", "│││", "┘└┘", "   "},
		'O': {"┌─┐", "│ │", "└─┘", "   "},
		'P': {"┌─┐", "├─┘", "┴  ", "   "},
		'Q': {"┌─┐ ", "│ │ ", "└─┼┐", "   └┘"},
		'R': {"┌─┐", "├┬┘", "┴└─", "   "},
		'S': {"┌─┐", "└─┐", "└─┘", "   "},
		'T': {"┌┬┐", " │ ", " ┴ ", "   "},
		'U': {"┬ ┬", "│ │", "└─┘", "   "},
		'V': {"┬  ┬", "└┐┌┘", " └┘ ", "    "},
		'W': {"┬ ┬", "│││", "└┴┘", "   "},
		'X': {"─┐ ┌─", "─┴─┴─", "     "},
		'Y': {"┬ ┬", "└┬┘", " ┴ ", "   "},
		'Z': {"┌─┐", "─┌┘", "└─┘", "   "},
		'0': {"┌─┐", "│ │", "└─┘", "   "},
		'1': {" ┬ ", " │ ", "┴┴┴", "   "},
		'2': {"┌─┐", "┌─┘", "└─┘", "   "},
		'3': {"┌─┐", " ─┤", "└─┘", "   "},
		'4': {"┬ ┬", "└─┤", "  ┴", "   "},
		'5': {"┌─┐", "└─┐", "└─┘", "   "},
		'6': {"┌─┐", "├─┐", "└─┘", "   "},
		'7': {"┌─┐", "  │", "  ┴", "   "},
		'8': {"┌─┐", "├─┤", "└─┘", "   "},
		'9': {"┌─┐", "└─┤", "└─┘", "   "},
		' ': {"  ", "  ", "  ", "  "},
		'-': {"   ", "───", "   ", "   "},
		'.': {" ", " ", "▄", " "},
		'!': {"┬", "│", "▄", " "},
	},
}

// Standard font - Classic terminal-style 5-line letters.
var Standard = Font{
	Name:     "standard",
	Height:   5,
	Fallback: ' ',
	Chars: map[rune][]string{
		'A': {"  ##  ", " #  # ", "######", "#    #", "#    #"},
		'B': {"##### ", "#    #", "##### ", "#    #", "##### "},
		'C': {" #####", "#     ", "#     ", "#     ", " #####"},
		'D': {"##### ", "#    #", "#    #", "#    #", "##### "},
		'E': {"######", "#     ", "##### ", "#     ", "######"},
		'F': {"######", "#     ", "##### ", "#     ", "#     "},
		'G': {" #####", "#     ", "#  ###", "#    #", " #####"},
		'H': {"#    #", "#    #", "######", "#    #", "#    #"},
		'I': {"######", "  ##  ", "  ##  ", "  ##  ", "######"},
		'J': {"     #", "     #", "     #", "#    #", " #####"},
		'K': {"#    #", "#   # ", "####  ", "#   # ", "#    #"},
		'L': {"#     ", "#     ", "#     ", "#     ", "######"},
		'M': {"#    #", "##  ##", "# ## #", "#    #", "#    #"},
		'N': {"#    #", "##   #", "# #  #", "#  # #", "#   ##"},
		'O': {" #### ", "#    #", "#    #", "#    #", " #### "},
		'P': {"##### ", "#    #", "##### ", "#     ", "#     "},
		'Q': {" #### ", "#    #", "#    #", "#  # #", " #### "},
		'R': {"##### ", "#    #", "##### ", "#   # ", "#    #"},
		'S': {" #####", "#     ", " #### ", "     #", "##### "},
		'T': {"######", "  ##  ", "  ##  ", "  ##  ", "  ##  "},
		'U': {"#    #", "#    #", "#    #", "#    #", " #### "},
		'V': {"#    #", "#    #", "#    #", " #  # ", "  ##  "},
		'W': {"#    #", "#    #", "# ## #", "##  ##", "#    #"},
		'X': {"#    #", " #  # ", "  ##  ", " #  # ", "#    #"},
		'Y': {"#    #", " #  # ", "  ##  ", "  ##  ", "  ##  "},
		'Z': {"######", "    # ", "   #  ", "  #   ", "######"},
		'0': {" #### ", "#   ##", "# #  #", "##   #", " #### "},
		'1': {"  ##  ", " # #  ", "   #  ", "   #  ", " #####"},
		'2': {" #####", "#    #", "   ## ", " ##   ", "######"},
		'3': {" #####", "     #", " #####", "     #", " #####"},
		'4': {"   ## ", "  # # ", " #  # ", "######", "    # "},
		'5': {"######", "#     ", "##### ", "     #", "##### "},
		'6': {" #####", "#     ", "##### ", "#    #", " #####"},
		'7': {"######", "    # ", "   #  ", "  #   ", " #    "},
		'8': {" #####", "#    #", " #####", "#    #", " #####"},
		'9': {" #####", "#    #", " #####", "     #", " #####"},
		' ': {"     ", "     ", "     ", "     ", "     "},
		'-': {"     ", "     ", "#####", "     ", "     "},
		'.': {"    ", "    ", "    ", "    ", " ## "},
		'!': {"  #  ", "  #  ", "  #  ", "     ", "  #  "},
	},
}

// registry contains all available fonts.
var registry = map[string]Font{
	"block":    Block,
	"slant":    Slant,
	"minimal":  Minimal,
	"small":    Small,
	"standard": Standard,
}

// Get returns a font by name. Returns Block font if not found.
func Get(name string) Font {
	if font, ok := registry[name]; ok {
		return font
	}
	return Block
}

// List returns a list of all available font names.
func List() []string {
	names := make([]string, 0, len(registry))
	for name := range registry {
		names = append(names, name)
	}
	return names
}

// Has checks if a font with the given name exists.
func Has(name string) bool {
	_, ok := registry[name]
	return ok
}

// Register adds a custom font to the registry.
func Register(font Font) {
	registry[font.Name] = font
}

// Generate creates ASCII art from text using the specified font.
func Generate(text string, fontName string) []string {
	font := Get(fontName)
	text = strings.ToUpper(text)

	lines := make([]string, font.Height)
	for i := 0; i < font.Height; i++ {
		var line strings.Builder
		for _, char := range text {
			line.WriteString(font.GetLine(char, i))
		}
		lines[i] = line.String()
	}

	return lines
}

// GenerateScaled creates ASCII art from text with scaling.
// Scale of 1 is normal size, 2 is double size, etc.
func GenerateScaled(text string, fontName string, scale int) []string {
	if scale <= 1 {
		return Generate(text, fontName)
	}

	font := Get(fontName)
	text = strings.ToUpper(text)

	// Get the base lines
	baseLines := make([][]string, font.Height)
	for i := 0; i < font.Height; i++ {
		baseLines[i] = make([]string, 0)
		for _, char := range text {
			charLine := font.GetLine(char, i)
			// Scale horizontally by repeating each character
			scaledLine := scaleLine(charLine, scale)
			baseLines[i] = append(baseLines[i], scaledLine)
		}
	}

	// Scale vertically by repeating each line
	result := make([]string, 0, font.Height*scale)
	for i := 0; i < font.Height; i++ {
		// Join all character parts for this line
		line := strings.Join(baseLines[i], "")
		// Repeat the line 'scale' times
		for j := 0; j < scale; j++ {
			result = append(result, line)
		}
	}

	return result
}
